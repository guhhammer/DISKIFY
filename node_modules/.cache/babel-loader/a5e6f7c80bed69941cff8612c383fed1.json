{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/Gustavo/Desktop/proj/Diskify/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\Gustavo\\\\Desktop\\\\proj\\\\Diskify\\\\src\\\\components\\\\Search.js\";\nimport React, { Component } from 'react';\nimport './Search.css';\nimport Web3 from 'web3';\nimport Diskify from '../abis/Diskify.json';\nimport no_results from '../no_results.png';\nimport aacover from '../aacover.jpg';\n\nvar _require = require('ipfs-http-client'),\n    create = _require.create;\n\nvar ipfs = create({\n  host: 'ipfs.infura.io',\n  port: 5001,\n  protocol: 'https'\n});\n\nvar Search = /*#__PURE__*/function (_Component) {\n  _inherits(Search, _Component);\n\n  var _super = _createSuper(Search);\n\n  function Search(props) {\n    var _this2;\n\n    _classCallCheck(this, Search);\n\n    _this2 = _super.call(this, props);\n\n    _this2.logging_noresult = function (_query) {\n      if (_query.length > 0) {//document.getElementById('div-noresults').innerHTML = '';\n      } else {//document.getElementById('div-noresults').innerHTML = \"\"; //add div later;\n      }\n    };\n\n    _this2.finder = function (number, query) {\n      var _this = _assertThisInitialized(_this2);\n\n      _this.contract.methods.getAlbum(number).call({\n        from: _this.eth_account\n      }).then(function (res) {\n        var aid = res['album_info_pointer_ipfs_hash'];\n        console.log('https://ipfs.infura.io/ipfs/' + aid);\n        fetch('https://ipfs.infura.io/ipfs/' + aid).then(function (res) {\n          return res.text();\n        }).then(function (res) {\n          var content = JSON.parse(res.toLowerCase());\n          var data_ = content['artist_name'] + \" \" + content['release_date'] + \" \" + content['album_name'] + \" \" + content['artist_name'] + \" \" + content['genres'] + \" \";\n          var tracks = content['track_names'];\n\n          for (var _i = 0; _i < tracks.length; _i++) {\n            data_ += tracks[_i] + \" \";\n          }\n\n          console.log(data_, data_.search(query.toLowerCase()));\n\n          if (data_.search(query.toLowerCase())) {\n            _this.resultConstructor(number);\n          }\n        }).catch(function (_) {\n          return console.log(\"error\");\n        });\n      }).catch(function () {\n        console.log('unfetchable');\n      });\n    };\n\n    _this2.resultConstructor = function (number) {\n      var _this = _assertThisInitialized(_this2);\n\n      var arr = [];\n\n      _this.contract.methods.getAlbum(number).call({\n        from: _this.eth_account\n      }).then(function (res) {\n        var aid = res['album_info_pointer_ipfs_hash'];\n        console.log(aid);\n        fetch('https://ipfs.infura.io/ipfs/' + aid).then(function (res) {\n          return res.text();\n        }).then(function (res) {\n          var content = JSON.parse(res);\n          arr.push(content['album_cover']);\n          arr.push(content['album_name']);\n          arr.push(content['genres']);\n          arr.push(content['artist_name']);\n\n          _this.appender(arr);\n        }).catch(function (_) {\n          return console.log(\"error2\");\n        });\n      }).catch(function () {});\n    };\n\n    _this2.appender = function (arr) {\n      console.log(arr);\n      var correct_path = 'https://ipfs.infura.io/ipfs/' + arr[0].split(\"/\")[4];\n\n      if (arr[1].length == 0) {\n        arr[1] = 'This album has no name!';\n      }\n\n      if (arr[2].length == 0) {\n        arr[2] = 'This album has no genres!';\n      }\n\n      if (arr[3].length == 0) {\n        arr[3] = 'This album has no artist name!';\n      }\n\n      document.getElementById('div-appendresults').innerHTML += \"<div> <div className=\\\"grid grid-rows-1 grid-cols-2 w-full bg-gray-100 border-gray-300  h-auto rounded-lg text-3xl p-4 mb-2 hover:bg-gray-100 border-4 border-transparent hover:border-black\\\">\\n\\n  \\t\\t<div className='w-1/2 h-1/2 min-w-80 min-h-80 h-auto '>\\n\\n  \\t\\t<img src='\".concat(correct_path, \"' id='img-1' className='h-auto w-auto' />\\n\\n  \\t\\t</div>\\n  \\t\\t\\n  \\t\\t<div className='grid grid-rows-2 grid-cols-1 text-3xl font-mono'>\\n\\n  \\t\\t\\t<p className=''> \").concat(arr[1], \" </p>\\n  \\t\\t\\n  \\t\\t\\t<p className='text-gray-900'> \").concat(arr[2], \" </p>\\n\\n\\t\\t\\t\\t<p className=''> \").concat(arr[3], \" </p>\\n\\t\\t\\t\\t                \\t\\t\\t\\n  \\t\\t</div>\\n\\n  \\t</div></div>\");\n    };\n\n    _this2.searching = function (event) {\n      event.preventDefault();\n      var _query = document.getElementById('input-search').value;\n\n      _this2.logging_noresult(_query);\n\n      var _this = _assertThisInitialized(_this2);\n\n      var limit = 0;\n\n      _this.contract.methods.album_id_counter().call({\n        from: _this.eth_account\n      }).then(function (r) {\n        limit = parseInt(r);\n      }).catch(function (_) {\n        return console.log(\"error\");\n      });\n\n      for (var i = 0; i < limit + 1; i++) {\n        _this.finder(i, _query);\n      }\n    };\n\n    _this2.state = {};\n    _this2.eth_account = '';\n    _this2.contract = '';\n    return _this2;\n  }\n\n  _createClass(Search, [{\n    key: \"componentWillMount\",\n    value: function () {\n      var _componentWillMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.loadWeb3();\n\n              case 2:\n                _context.next = 4;\n                return this.loadBlockchainData();\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentWillMount() {\n        return _componentWillMount.apply(this, arguments);\n      }\n\n      return componentWillMount;\n    }()\n  }, {\n    key: \"loadBlockchainData\",\n    value: function () {\n      var _loadBlockchainData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var web3, accounts, networdId, networkData, abi;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                web3 = window.web3;\n                _context2.next = 3;\n                return web3.eth.getAccounts();\n\n              case 3:\n                accounts = _context2.sent;\n                this.eth_account = accounts[0];\n                console.log(accounts);\n                _context2.next = 8;\n                return web3.eth.net.getId();\n\n              case 8:\n                networdId = _context2.sent;\n                networkData = Diskify.networks[networdId];\n                console.log(networkData, networdId);\n\n                if (!networkData) {\n                  _context2.next = 16;\n                  break;\n                }\n\n                abi = Diskify.abi;\n                this.contract = new web3.eth.Contract(abi, networkData.address);\n                _context2.next = 18;\n                break;\n\n              case 16:\n                window.alert(\"Contract not deployed.\");\n                return _context2.abrupt(\"return\");\n\n              case 18:\n                console.log(this.contract);\n\n              case 19:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadBlockchainData() {\n        return _loadBlockchainData.apply(this, arguments);\n      }\n\n      return loadBlockchainData;\n    }()\n  }, {\n    key: \"loadWeb3\",\n    value: function () {\n      var _loadWeb = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!window.ethereum) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                window.web3 = new Web3(window.ethereum);\n                _context3.next = 4;\n                return window.ethereum.enable();\n\n              case 4:\n                if (window.web3) {\n                  window.web3 = new Web3(window.web3.currentProvider);\n                } else {\n                  console.log(\"User did not connect its metamask wallet.\");\n                }\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function loadWeb3() {\n        return _loadWeb.apply(this, arguments);\n      }\n\n      return loadWeb3;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 4\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"container-fluid mt-5\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"main\", {\n        role: \"main\",\n        className: \"col-lg-12 d-flex grid grid-cols-1 text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        id: \"div-search\",\n        className: \"mr-auto ml-auto -mt-8 w-5/6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        id: \"input-search\",\n        onChange: this.searching,\n        className: \"font-mono w-5/6 bg-gray-100 border-gray-300 h-auto rounded-lg text-3xl p-4 mb-2 hover:bg-gray-100 border-4 border-transparent hover:border-black\",\n        placeholder: \" Search... \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        id: \"div-appendresults\",\n        className: \"mt-4 container-fluid content-center self-center text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 17\n        }\n      }))))));\n    }\n  }]);\n\n  return Search;\n}(Component);\n\nexport default Search;\n/*\r\n\r\n\r\n                <div id='div-noresults' className=' self-center ml-auto mr-auto w-1/2 h-1/2 min-h-96 min-w-96 max-w-96 max-h-96' > \r\n                \t\r\n                \t<br /><br /><br />\r\n\r\n\t                <img src={no_results} id='img-noresults' className=\" Album_cover_display\" alt=\"no results\" />\r\n  \r\n                </div>\r\n\r\n\r\n\r\n\r\n*/","map":{"version":3,"sources":["C:/Users/Gustavo/Desktop/proj/Diskify/src/components/Search.js"],"names":["React","Component","Web3","Diskify","no_results","aacover","require","create","ipfs","host","port","protocol","Search","props","logging_noresult","_query","length","finder","number","query","_this","contract","methods","getAlbum","call","from","eth_account","then","res","aid","console","log","fetch","text","content","JSON","parse","toLowerCase","data_","tracks","_i","search","resultConstructor","catch","_","arr","push","appender","correct_path","split","document","getElementById","innerHTML","searching","event","preventDefault","value","limit","album_id_counter","r","parseInt","i","state","loadWeb3","loadBlockchainData","web3","window","eth","getAccounts","accounts","net","getId","networdId","networkData","networks","abi","Contract","address","alert","ethereum","enable","currentProvider"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport './Search.css';\r\n\r\nimport Web3 from 'web3';\r\nimport Diskify from '../abis/Diskify.json';\r\n\r\nimport no_results from '../no_results.png';\r\n\r\n\r\nimport aacover from '../aacover.jpg';\r\n\r\n\r\nconst {create} = require('ipfs-http-client');\r\n\r\nconst ipfs = create({host: 'ipfs.infura.io', port:5001, protocol:'https'});\r\n\r\n\r\nclass Search extends Component {\r\n\r\n\tasync componentWillMount() {\r\n\r\n    await this.loadWeb3();\r\n\r\n    await this.loadBlockchainData();\r\n\r\n  }\r\n\r\n  async loadBlockchainData() {\r\n\r\n    const web3 = window.web3;\r\n\r\n    const accounts = await web3.eth.getAccounts();\r\n\r\n    this.eth_account = accounts[0];\r\n\r\n    console.log(accounts);\r\n\r\n    const networdId = await web3.eth.net.getId();\r\n    const networkData = Diskify.networks[networdId];\r\n\r\n    console.log(networkData, networdId)\r\n\r\n    if (networkData) {\r\n\r\n      const abi = Diskify.abi;\r\n      this.contract = new web3.eth.Contract(abi, networkData.address);\r\n\r\n\r\n    } else { window.alert(\"Contract not deployed.\"); return; }\r\n    \r\n    console.log(this.contract);\r\n\r\n  }\r\n\r\n\r\n\r\n  constructor (props) {\r\n\r\n  \tsuper(props);\r\n\r\n  \tthis.state = {};\r\n\r\n  \tthis.eth_account = '';\r\n  \tthis.contract = '';\r\n\r\n  }\r\n\r\n\r\n  async loadWeb3() {\r\n\r\n\t  if (window.ethereum) {\r\n\r\n\t    window.web3 = new Web3(window.ethereum);\r\n\t    await window.ethereum.enable();\r\n\r\n\t  } if (window.web3) {\r\n\r\n\t    window.web3 = new Web3(window.web3.currentProvider);\r\n\r\n\t  } else {\r\n\r\n\t  \tconsole.log(\"User did not connect its metamask wallet.\");\r\n\r\n\t  }\r\n\r\n\t}\r\n\r\n\r\n\tlogging_noresult = (_query) => {\r\n\r\n\t\tif (_query.length > 0){\r\n\r\n\t\t\t//document.getElementById('div-noresults').innerHTML = '';\r\n\r\n\t\t} else {\r\n\r\n\t\t\t//document.getElementById('div-noresults').innerHTML = \"\"; //add div later;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tfinder = (number, query) => {\r\n\r\n\t\tconst _this = this;\r\n\r\n    _this.contract.methods.getAlbum(number).call({from: _this.eth_account}).then((res) => {\r\n\r\n    \t\tvar aid = res['album_info_pointer_ipfs_hash'];\r\n\r\n    \t\tconsole.log('https://ipfs.infura.io/ipfs/'+aid);\r\n\r\n    \t\tfetch('https://ipfs.infura.io/ipfs/'+aid)\r\n    \t\t.then((res)=>res.text())\r\n    \t\t.then((res)=>{\r\n\r\n    \t\t\tconst content = JSON.parse(res.toLowerCase());\r\n\r\n    \t\t\tvar data_ = content['artist_name']+ \" \"+content['release_date']+ \" \"+\r\n    \t\t\t          content['album_name']+ \" \"+content['artist_name']+\" \"+content['genres']+\" \";\r\n\r\n    \t\t\tconst tracks = content['track_names'];\r\n    \t\t\t\r\n    \t\t\tfor (var _i = 0; _i < tracks.length; _i++){\r\n\r\n    \t\t\t\tdata_ += tracks[_i]+\" \";\r\n\r\n    \t\t\t}\r\n\r\n    \t\t\tconsole.log(data_, data_.search(query.toLowerCase()))\r\n\r\n    \t\t\tif (data_.search(query.toLowerCase())) {\r\n\r\n    \t\t\t\t\t_this.resultConstructor(number);\r\n\r\n    \t\t\t}\r\n\r\n    \t\t}).catch( _ => console.log(\"error\"));\r\n\r\n\r\n    }).catch(() => {\r\n\r\n    \tconsole.log('unfetchable');\r\n    \t\r\n    } );\r\n\r\n\t}\r\n\r\n\r\n\tresultConstructor = (number) => {\r\n\r\n\t\tconst _this = this;\r\n\r\n\t\tvar arr = [];\r\n\r\n\t\t_this.contract.methods.getAlbum(number).call({from: _this.eth_account}).then((res) => {\r\n\r\n    \t\tvar aid = res['album_info_pointer_ipfs_hash'];\r\n\r\n    \t\tconsole.log(aid);\r\n\r\n    \t\tfetch('https://ipfs.infura.io/ipfs/'+aid)\r\n    \t\t.then((res)=>res.text())\r\n    \t\t.then((res)=>{\r\n\r\n    \t\t\tconst content = JSON.parse(res);\r\n\r\n    \t\t\tarr.push(content['album_cover']);\r\n    \t\t\tarr.push(content['album_name']);\r\n    \t\t\tarr.push(content['genres']);\r\n    \t\t\tarr.push(content['artist_name']);\r\n\r\n    \t\t\t_this.appender(arr);\r\n\r\n    \t\t}).catch( _ => console.log(\"error2\"));\r\n\r\n\r\n    }).catch(() => {\r\n\r\n    } );\r\n\r\n\t\t\r\n\r\n\t}\r\n\r\n\r\n\tappender = (arr) => {\r\n\r\n\t\tconsole.log(arr);\r\n\r\n\t\tconst correct_path = 'https://ipfs.infura.io/ipfs/'+arr[0].split(\"/\")[4];\r\n\r\n\t\tif (arr[1].length == 0) { arr[1] = 'This album has no name!'; }\r\n\t\tif (arr[2].length == 0) { arr[2] = 'This album has no genres!'; }\r\n\t\tif (arr[3].length == 0) { arr[3] = 'This album has no artist name!'; }\r\n\r\n\t\tdocument.getElementById('div-appendresults').innerHTML += \r\n\r\n\t\t`<div> <div className=\"grid grid-rows-1 grid-cols-2 w-full bg-gray-100 border-gray-300  h-auto rounded-lg text-3xl p-4 mb-2 hover:bg-gray-100 border-4 border-transparent hover:border-black\">\r\n\r\n  \t\t<div className='w-1/2 h-1/2 min-w-80 min-h-80 h-auto '>\r\n\r\n  \t\t<img src='${correct_path}' id='img-1' className='h-auto w-auto' />\r\n\r\n  \t\t</div>\r\n  \t\t\r\n  \t\t<div className='grid grid-rows-2 grid-cols-1 text-3xl font-mono'>\r\n\r\n  \t\t\t<p className=''> ${arr[1]} </p>\r\n  \t\t\r\n  \t\t\t<p className='text-gray-900'> ${arr[2]} </p>\r\n\r\n\t\t\t\t<p className=''> ${arr[3]} </p>\r\n\t\t\t\t                \t\t\t\r\n  \t\t</div>\r\n\r\n  \t</div></div>`;\r\n\r\n\r\n\t}\r\n\r\n\r\n\r\n\tsearching = (event) => {\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tconst _query = document.getElementById('input-search').value;\r\n\r\n\t\tthis.logging_noresult(_query);\r\n\r\n\t\tconst _this = this;\r\n\r\n\r\n\t\tvar limit = 0;\r\n\t\t_this.contract.methods.album_id_counter().call({from: _this.eth_account})\r\n\t\t.then( (r) => { limit = parseInt(r); })\r\n\t\t.catch( _ => console.log(\"error\") );\r\n\r\n\t\tfor( var i = 0; i < limit+1; i++ ){\r\n\r\n\t\t\t_this.finder(i, _query);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\trender(){\r\n\r\n\t\treturn (\r\n\r\n\t\t\t<div>\r\n        <div className=\"container-fluid mt-5\">\r\n          <div className=\"row\">\r\n            <main role=\"main\" className=\"col-lg-12 d-flex grid grid-cols-1 text-center\">\r\n              <div id='div-search' className=\"mr-auto ml-auto -mt-8 w-5/6\">\r\n              \r\n\r\n                <input type='text' id='input-search' onChange={this.searching} className='font-mono w-5/6 bg-gray-100 border-gray-300 h-auto rounded-lg text-3xl p-4 mb-2 hover:bg-gray-100 border-4 border-transparent hover:border-black' placeholder=\" Search... \" />\r\n                <br/>\r\n\r\n                \r\n                <div id='div-appendresults' className=\"mt-4 container-fluid content-center self-center text-center\">\r\n\r\n \r\n\r\n\r\n\r\n                </div>\r\n                \r\n              </div>\r\n            </main>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n\r\n\r\n\t\t);\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport default Search;\r\n/*\r\n\r\n\r\n                <div id='div-noresults' className=' self-center ml-auto mr-auto w-1/2 h-1/2 min-h-96 min-w-96 max-w-96 max-h-96' > \r\n                \t\r\n                \t<br /><br /><br />\r\n\r\n\t                <img src={no_results} id='img-noresults' className=\" Album_cover_display\" alt=\"no results\" />\r\n  \r\n                </div>\r\n\r\n\r\n\r\n\r\n*/"]},"metadata":{},"sourceType":"module"}